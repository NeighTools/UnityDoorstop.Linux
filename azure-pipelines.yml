trigger:
- master

jobs:
  - job: LinuxBuild
    displayName: 'Build Linux'
    pool:
      vmImage: 'ubuntu-latest'
    steps:
    - script: |
        sudo apt-get -y install gcc-multilib
      displayName: 'getting deps'
    - script: |
        make
      displayName: 'make'
    - task: ArchiveFiles@2
      inputs:
        rootFolderOrFile: '-i $(Build.BinariesDirectory)/*.so'
        includeRootFolder: true
        archiveType: 'zip'
        archiveFile: '$(Build.ArtifactStagingDirectory)/doorstop_linux_$(Build.BuildId).zip'
        replaceExistingArchive: true
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Build.ArtifactStagingDirectory)/doorstop_linux_$(Build.BuildId).zip'
        ArtifactName: 'doorstop_linux'
        publishLocation: 'Container'
  - job: MacOSBuild
    displayName: 'Build MacOS'
    pool:
      vmImage: 'macOS-10.13'
    steps:
    - script: |
        make
      displayName: 'make'
    - task: ArchiveFiles@2
      inputs:
        rootFolderOrFile: '-i $(Build.BinariesDirectory)/*.dylib'
        includeRootFolder: true
        archiveType: 'zip'
        archiveFile: '$(Build.ArtifactStagingDirectory)/doorstop_macos_$(Build.BuildId).zip'
        replaceExistingArchive: true
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Build.ArtifactStagingDirectory)/doorstop_macos_$(Build.BuildId).zip'
        ArtifactName: 'doorstop_macos'
        publishLocation: 'Container'



